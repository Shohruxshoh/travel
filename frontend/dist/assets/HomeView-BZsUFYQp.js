import{d as B,r as p,u as E,o as F,a as u,c,b as t,t as r,e as s,f as d,w as M,g as f,v as N,n as w,F as T,h as U,i as y,j as P,k as V,l as q,m as C}from"./index-BpYQUURI.js";import{a as x}from"./axios-C_l6dxSh.js";const L=B("booking",()=>{const g=p([]),o=p(!1),_=p(!1),i=p(!1),e=p(null);async function a(){o.value=!0;try{const b=await x.get("/tours/");g.value=b.data}catch(b){console.error("Failed to fetch tours:",b)}finally{o.value=!1}}async function h(b){var k,v;_.value=!0,i.value=!1,e.value=null;try{await x.post("/bookings/",b),i.value=!0}catch($){e.value=((v=(k=$.response)==null?void 0:k.data)==null?void 0:v.detail)||"An unexpected error occurred."}finally{_.value=!1}}function S(){i.value=!1,e.value=null}return{tours:g,isLoadingTours:o,isSubmitting:_,submitSuccess:i,submitError:e,fetchTours:a,submitBooking:h,resetState:S}}),z={class:"booking-section",id:"booking-form"},D={class:"container"},A={class:"section-title"},H={class:"section-subtitle"},I={class:"booking-form-wrapper"},R={key:0,class:"alert alert-success"},j={key:1,class:"alert alert-error"},G={class:"form-group"},J={class:"form-label",for:"booking-tour"},K={value:"",disabled:""},O=["value"],Q={key:0,class:"form-error"},W={class:"form-group"},X={class:"form-label",for:"booking-name"},Y=["placeholder"],Z={key:0,class:"form-error"},ee={class:"form-group"},oe={class:"form-label",for:"booking-email"},se=["placeholder"],te={key:0,class:"form-error"},re={class:"form-group"},ie={class:"form-label",for:"booking-phone"},ae=["placeholder"],ne={class:"form-group"},le={class:"form-label",for:"booking-message"},ue=["placeholder"],ce=["disabled"],me={key:0,class:"spinner"},de={__name:"BookingForm",setup(g){const{t:o,locale:_}=E(),i=L(),e=V({tour_id:"",customer_name:"",customer_email:"",customer_phone:"",message:""}),a=V({tour_id:!1,customer_name:!1,customer_email:!1}),h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,S=q(()=>e.customer_email?h.test(e.customer_email)?"":o("booking.invalidEmail"):o("booking.required"));function b(m,l){const n=`${l}_${_.value}`;return m[n]||m[`${l}_en`]||""}function k(){let m=!0;return a.tour_id=!e.tour_id,a.tour_id&&(m=!1),a.customer_name=!e.customer_name.trim(),a.customer_name&&(m=!1),a.customer_email=!e.customer_email.trim()||!h.test(e.customer_email),a.customer_email&&(m=!1),m}async function v(){k()&&await i.submitBooking({tour_id:Number(e.tour_id),customer_name:e.customer_name.trim(),customer_email:e.customer_email.trim(),customer_phone:e.customer_phone.trim()||null,message:e.message.trim()||null,language:_.value})}function $(){e.tour_id="",e.customer_name="",e.customer_email="",e.customer_phone="",e.message="",a.tour_id=!1,a.customer_name=!1,a.customer_email=!1,i.resetState()}return F(()=>{i.fetchTours()}),(m,l)=>(u(),c("section",z,[t("div",D,[t("h2",A,r(s(o)("booking.title")),1),t("p",H,r(s(o)("booking.subtitle")),1),t("div",I,[s(i).submitSuccess?(u(),c("div",R," ✅ "+r(s(o)("booking.success")),1)):d("",!0),s(i).submitError?(u(),c("div",j," ❌ "+r(s(i).submitError),1)):d("",!0),s(i).submitSuccess?d("",!0):(u(),c("form",{key:2,onSubmit:M(v,["prevent"]),novalidate:""},[t("div",G,[t("label",J,r(s(o)("booking.tour")),1),f(t("select",{id:"booking-tour","onUpdate:modelValue":l[0]||(l[0]=n=>e.tour_id=n),class:w(["form-select",{error:a.tour_id}])},[t("option",K,r(s(o)("booking.tourPlaceholder")),1),(u(!0),c(T,null,U(s(i).tours,n=>(u(),c("option",{key:n.id,value:n.id},r(b(n,"title"))+" — $"+r(n.price),9,O))),128))],2),[[N,e.tour_id]]),a.tour_id?(u(),c("p",Q,r(s(o)("booking.required")),1)):d("",!0)]),t("div",W,[t("label",X,r(s(o)("booking.name")),1),f(t("input",{id:"booking-name","onUpdate:modelValue":l[1]||(l[1]=n=>e.customer_name=n),type:"text",class:w(["form-input",{error:a.customer_name}]),placeholder:s(o)("booking.namePlaceholder")},null,10,Y),[[y,e.customer_name]]),a.customer_name?(u(),c("p",Z,r(s(o)("booking.required")),1)):d("",!0)]),t("div",ee,[t("label",oe,r(s(o)("booking.email")),1),f(t("input",{id:"booking-email","onUpdate:modelValue":l[2]||(l[2]=n=>e.customer_email=n),type:"email",class:w(["form-input",{error:a.customer_email}]),placeholder:s(o)("booking.emailPlaceholder")},null,10,se),[[y,e.customer_email]]),a.customer_email?(u(),c("p",te,r(S.value),1)):d("",!0)]),t("div",re,[t("label",ie,r(s(o)("booking.phone")),1),f(t("input",{id:"booking-phone","onUpdate:modelValue":l[3]||(l[3]=n=>e.customer_phone=n),type:"tel",class:"form-input",placeholder:s(o)("booking.phonePlaceholder")},null,8,ae),[[y,e.customer_phone]])]),t("div",ne,[t("label",le,r(s(o)("booking.message")),1),f(t("textarea",{id:"booking-message","onUpdate:modelValue":l[4]||(l[4]=n=>e.message=n),class:"form-textarea",placeholder:s(o)("booking.messagePlaceholder"),rows:"4"},null,8,ue),[[y,e.message]])]),t("button",{type:"submit",class:"btn btn-primary",style:{width:"100%"},disabled:s(i).isSubmitting},[s(i).isSubmitting?(u(),c("span",me)):d("",!0),P(" "+r(s(i).isSubmitting?s(o)("booking.submitting"):s(o)("booking.submit")),1)],8,ce)],32)),s(i).submitSuccess?(u(),c("button",{key:3,class:"btn btn-primary",style:{width:"100%","margin-top":"16px"},onClick:$},r(s(o)("booking.submit")),1)):d("",!0)])])]))}},_e={class:"hero"},be={class:"container"},pe={href:"#booking-form",class:"btn btn-accent"},he={__name:"HomeView",setup(g){return(o,_)=>(u(),c("div",null,[t("section",_e,[t("div",be,[t("h1",null,r(o.$t("hero.title")),1),t("p",null,r(o.$t("hero.subtitle")),1),t("a",pe,r(o.$t("hero.cta")),1)])]),C(de)]))}};export{he as default};
